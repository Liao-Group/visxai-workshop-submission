<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nucleotide Comparison View</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .chart-container {
            width: 800px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <svg id="nucleotide-chart"></svg>
    </div>
<script>
// Set up dimensions
const width = 800;
const height = 400;
const margin = { top: 30, right: 10, bottom: 20, left: 50, middle: 22 };
const chartWidth = width - margin.left - margin.right;
const chartHeight = height - margin.top - margin.bottom;

// Color scheme
const inclusion_color = "#c5d6fb";
const skipping_color = "#f6c3c2";
const inclusion_light = "#e2ebfd";
const inclusion_dark = "#89adff";
const skipping_light = "#fae1e0";
const skipping_dark = "#f47c79";

// Simulated data
const nucleotides = ['A', 'T', 'G', 'C', 'G', 'A', 'T', 'C', 'A', 'G'];
const originalData = {
    inclusion: [0.5, 0.7, 0.3, 0.6, 0.8, 0.4, 0.9, 0.2, 0.5, 0.7],
    skipping: [0.3, 0.5, 0.7, 0.2, 0.6, 0.8, 0.4, 0.9, 0.3, 0.5]
};
const comparisonData = {
    inclusion: [0.6, 0.5, 0.4, 0.7, 0.7, 0.5, 0.8, 0.3, 0.6, 0.6],
    skipping: [0.4, 0.6, 0.5, 0.3, 0.5, 0.7, 0.5, 0.8, 0.4, 0.4]
};

// Create SVG
const svg = d3.select("#nucleotide-chart")
    .attr("width", width)
    .attr("height", height);

// Create scales
const x = d3.scaleBand()
    .range([margin.left, width - margin.right])
    .domain(d3.range(1, nucleotides.length + 1))
    .paddingInner(0.2)
    .paddingOuter(0.25);

const y = d3.scaleLinear()
    .range([margin.top + (height - margin.top - margin.bottom) / 2 - margin.middle, margin.top])
    .domain([0, d3.max([...originalData.inclusion, ...comparisonData.inclusion])]);

const ySkip = d3.scaleLinear()
    .range([height - margin.bottom, margin.top + (height - margin.top - margin.bottom) / 2 + margin.middle])
    .domain([0, d3.max([...originalData.skipping, ...comparisonData.skipping])]);

// Create axes
const xInclAxis = d3.axisBottom(x)
    .tickSize(2)
    .tickFormat(d => ((d % 10 === 0) || (d === 1) || (d === nucleotides.length)) ? d : '');

const xSkipAxis = d3.axisTop(x)
    .tickSize(2)
    .tickFormat(d => nucleotides[d - 1]);

const xNuAxis = d3.axisBottom(x)
    .tickSize(0)
    .tickFormat(d => nucleotides[d - 1]);

// Add axes to SVG
const gxIncl = svg.append("g")
    .attr("class", "x axis")
    .attr("transform", `translate(0,${margin.top + (height - margin.top - margin.bottom) / 2 - margin.middle})`)
    .call(xInclAxis);

const gxSkip = svg.append("g")
    .attr("class", "x axis")
    .attr("transform", `translate(0,${margin.top + (height - margin.top - margin.bottom) / 2 + margin.middle})`)
    .call(xSkipAxis);

const gxNu = svg.append("g")
    .attr("class", "x axis")
    .attr("transform", `translate(0,${margin.top + (height - margin.top - margin.bottom) / 2 - 5})`)
    .call(xNuAxis);

gxNu.selectAll("path").style("stroke-width", 0);

// Add Y axes
const gyIncl = svg.append("g")
    .attr("class", "y axis")
    .attr("transform", `translate(${margin.left},0)`)
    .call(d3.axisLeft(y).ticks(4));

const gySkip = svg.append("g")
    .attr("class", "y axis")
    .attr("transform", `translate(${margin.left},0)`)
    .call(d3.axisLeft(ySkip).ticks(4));

// Draw bars function
function drawBars(data, compData, yScale, color, lightColor, darkColor, isSkipping = false) {
    const barGroups = svg.selectAll(`.bar-group-${isSkipping ? 'skip' : 'incl'}`)
        .data(data)
        .enter()
        .append("g")
        .attr("class", `bar-group-${isSkipping ? 'skip' : 'incl'}`)
        .attr("transform", (d, i) => `translate(${x(i + 1)},0)`);

    // Original data bar
    barGroups.append("rect")
        .attr("class", (d, i) => `obj ${isSkipping ? 'skip' : 'incl'} pos_${i + 1}`)
        .attr("y", d => isSkipping ? ySkip(d) : y(d))
        .attr("width", x.bandwidth())
        .attr("height", d => isSkipping ? ySkip(0) - ySkip(d) : y(0) - y(d))
        .attr("fill", color);

    // Comparison data bar (on top)
    barGroups.append("rect")
        .attr("class", (d, i) => `obj ${isSkipping ? 'skip' : 'incl'} pos_${i + 1}`)
        .attr("y", (d, i) => {
            if (isSkipping) {
                return ySkip(compData[i]);
            } else {
                return y(compData[i]);
            }
        })
        .attr("width", x.bandwidth())
        .attr("height", (d, i) => {
            if (isSkipping) {
                return ySkip(d) - ySkip(compData[i]);
            } else {
                return y(d) - y(compData[i]);
            }
        })
        .attr("fill", (d, i) => compData[i] > d ? darkColor : lightColor);
}

// Draw bars
drawBars(originalData.inclusion, comparisonData.inclusion, y, inclusion_color, inclusion_light, inclusion_dark);
drawBars(originalData.skipping, comparisonData.skipping, ySkip, skipping_color, skipping_light, skipping_dark, true);

        </script>
    
</body>
</html>
